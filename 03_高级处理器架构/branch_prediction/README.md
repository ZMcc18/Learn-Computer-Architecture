# 分支预测模拟器

这个模拟器展示了现代处理器中分支预测的工作原理和各种预测算法的性能比较。

## 功能特点

- 实现多种分支预测算法
- 可视化分支预测过程和结果
- 提供预测准确率和性能分析
- 支持真实程序跟踪分析
- 比较不同预测器在各种工作负载下的表现

## 文件说明

- `predictor.py`: 分支预测器基类和各种实现
- `branch_trace.py`: 分支跟踪和分析
- `btb.py`: 分支目标缓冲实现
- `simulator.py`: 模拟器主程序
- `visualizer.py`: 预测过程可视化
- `analysis.py`: 性能分析工具
- `traces/`: 示例分支跟踪数据
- `benchmarks/`: 基准测试程序

## 使用方法

1. 运行模拟器：

```bash
python simulator.py [跟踪文件] [--predictor 预测器类型]
```

预测器类型选项：
- `static`: 静态预测器
- `1bit`: 1位饱和计数器
- `2bit`: 2位饱和计数器
- `correlating`: 关联预测器
- `tournament`: 锦标赛预测器
- `perceptron`: 感知器预测器

2. 交互式命令：

- `step [n]`: 模拟n个分支
- `run`: 模拟所有分支
- `stats`: 显示预测统计
- `compare`: 比较不同预测器
- `visualize`: 可视化预测过程
- `help`: 显示帮助信息
- `quit`: 退出模拟器

## 分支预测算法

### 静态预测

静态预测器总是做出相同的预测，不考虑分支历史：

- **总是取分支(Always Taken)**: 总是预测分支会被执行
- **总是不取分支(Always Not Taken)**: 总是预测分支不会被执行
- **BTFN(Backward Taken, Forward Not taken)**: 向后跳转预测为取，向前跳转预测为不取

### 动态预测

动态预测器根据分支的历史行为进行预测：

#### 局部历史预测器

- **1位预测器**: 使用1位饱和计数器记录最近一次分支结果
- **2位预测器**: 使用2位饱和计数器，提供迟滞性以减少抖动
- **N位预测器**: 使用N位饱和计数器，提供更细粒度的预测状态

#### 全局历史预测器

- **全局历史寄存器(GHR)**: 记录最近N个分支的结果
- **关联预测器(Correlating Predictor)**: 结合分支地址和全局历史
- **gshare**: 使用分支地址和全局历史的异或作为索引

#### 混合预测器

- **锦标赛预测器(Tournament Predictor)**: 使用元预测器选择局部或全局预测器
- **TAGE预测器**: 使用多个不同历史长度的预测表
- **神经网络预测器**: 使用感知器或其他神经网络模型进行预测

### 分支目标缓冲(BTB)

BTB缓存分支指令的目标地址，减少分支目标计算延迟：

- **直接映射BTB**: 使用分支地址的低位作为索引
- **组相联BTB**: 提供多路组相联以减少冲突
- **预测返回地址栈(RAS)**: 专门用于预测函数返回地址

## 性能指标

模拟器提供以下性能指标：

- **预测准确率(Prediction Accuracy)**: 正确预测的百分比
- **MPKI(Misses Per Kilo Instructions)**: 每千条指令的预测失误数
- **预测器大小(Predictor Size)**: 预测器所需的存储空间
- **分支惩罚(Branch Penalty)**: 预测失误导致的周期损失
- **预测器更新延迟(Update Latency)**: 预测器状态更新所需的周期

## 学习要点

通过这个模拟器，你可以学习：

1. 分支预测的基本原理和重要性
2. 各种分支预测算法的工作机制
3. 分支行为模式和可预测性分析
4. 预测器设计中的空间-性能权衡
5. 现代处理器中的分支预测技术

## 扩展思路

1. 实现更先进的预测算法（如TAGE-SC-L）
2. 添加上下文敏感的分支分析
3. 实现预测器训练和自适应机制
4. 添加多线程工作负载的分支预测
5. 集成到流水线模拟器中分析系统性能影响 