# 控制单元模拟器

这个模拟器展示了CPU控制单元的工作原理，包括控制信号的生成和状态机的实现。

## 功能特点

- 可视化控制单元状态机
- 模拟控制信号的生成过程
- 支持单周期和多周期CPU控制
- 展示微程序控制的实现
- 提供交互式操作界面

## 文件说明

- `control_unit.py`: 控制单元核心实现
- `microcode.py`: 微程序存储器实现
- `state_machine.py`: 状态机实现
- `signal_generator.py`: 控制信号生成器
- `simulator.py`: 模拟器主程序
- `visualizer.py`: 控制单元可视化
- `examples/`: 示例微程序

## 使用方法

1. 运行模拟器：

```bash
python simulator.py [微程序文件]
```

2. 交互式命令：

- `step`: 单步执行一个时钟周期
- `run`: 连续执行
- `show`: 显示当前控制单元状态
- `signal <名称>`: 显示特定控制信号的状态
- `help`: 显示帮助信息
- `quit`: 退出模拟器

## 控制单元类型

### 硬连线控制单元

硬连线控制单元使用组合逻辑电路直接从指令操作码生成控制信号。它的特点是：

- 速度快，延迟小
- 设计复杂，难以修改
- 适合简单指令集

### 微程序控制单元

微程序控制单元使用微程序存储器存储控制序列，通过微程序计数器访问微指令。它的特点是：

- 设计灵活，易于修改
- 速度相对较慢
- 适合复杂指令集

## 控制信号

主要控制信号包括：

- `PCWrite`: 控制PC更新
- `MemRead`: 控制内存读取
- `MemWrite`: 控制内存写入
- `IRWrite`: 控制指令寄存器写入
- `RegDst`: 选择目标寄存器
- `RegWrite`: 控制寄存器写入
- `ALUSrcA`: 选择ALU的A输入
- `ALUSrcB`: 选择ALU的B输入
- `ALUOp`: 控制ALU操作
- `PCSource`: 选择PC的下一个值

## 状态机

多周期CPU的控制单元实现为一个状态机，包含以下状态：

1. **取指令(Fetch)**: 从内存读取指令
2. **解码(Decode)**: 解析指令，读取寄存器
3. **执行(Execute)**: 执行ALU操作
4. **访存(Memory)**: 读写内存
5. **写回(Writeback)**: 将结果写回寄存器

## 学习要点

通过这个模拟器，你可以学习：

1. 控制单元的基本结构和功能
2. 控制信号如何影响数据通路
3. 状态机在CPU控制中的应用
4. 微程序控制的实现方式
5. 单周期和多周期CPU的控制差异

## 扩展思路

1. 实现更复杂的指令集支持
2. 添加流水线控制逻辑
3. 实现动态分支预测
4. 添加异常和中断处理
5. 实现超标量控制逻辑 