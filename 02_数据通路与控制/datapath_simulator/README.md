# 数据通路模拟器

这个模拟器展示了CPU内部数据通路的工作原理，包括各个功能单元之间的数据流动和控制信号的作用。

## 功能特点

- 可视化CPU数据通路结构
- 模拟指令执行过程中的数据流动
- 展示控制信号如何影响数据通路
- 支持单周期和多周期CPU模型
- 提供交互式操作界面

## 文件说明

- `datapath.py`: 数据通路核心实现
- `control_signals.py`: 控制信号生成
- `functional_units.py`: 功能单元（ALU、寄存器等）
- `bus.py`: 总线模型
- `simulator.py`: 模拟器主程序
- `visualizer.py`: 数据通路可视化
- `examples/`: 示例指令序列

## 使用方法

1. 运行模拟器：

```bash
python simulator.py [指令文件]
```

2. 交互式命令：

- `step`: 单步执行一个时钟周期
- `run`: 连续执行
- `show`: 显示当前数据通路状态
- `signal <名称>`: 显示特定控制信号的状态
- `help`: 显示帮助信息
- `quit`: 退出模拟器

## 数据通路组件

### 功能单元

- **程序计数器(PC)**: 存储下一条要执行的指令地址
- **指令存储器(IM)**: 存储程序指令
- **寄存器文件(RF)**: 存储操作数和结果
- **算术逻辑单元(ALU)**: 执行算术和逻辑运算
- **数据存储器(DM)**: 存储程序数据
- **控制单元(CU)**: 生成控制信号

### 数据通路连接

- **总线**: 连接各个功能单元的数据通道
- **多路复用器(MUX)**: 选择数据源
- **控制线**: 传递控制信号

## 控制信号

主要控制信号包括：

- `PCWrite`: 控制PC更新
- `MemRead`: 控制内存读取
- `MemWrite`: 控制内存写入
- `IRWrite`: 控制指令寄存器写入
- `RegDst`: 选择目标寄存器
- `RegWrite`: 控制寄存器写入
- `ALUSrcA`: 选择ALU的A输入
- `ALUSrcB`: 选择ALU的B输入
- `ALUOp`: 控制ALU操作
- `PCSource`: 选择PC的下一个值

## 学习要点

通过这个模拟器，你可以学习：

1. CPU数据通路的基本组成和结构
2. 控制信号如何协调数据通路组件
3. 指令执行过程中的数据流动
4. 单周期和多周期CPU的区别
5. 数据通路设计如何影响CPU性能

## 扩展思路

1. 添加流水线数据通路模型
2. 实现更复杂的控制逻辑
3. 添加数据冒险检测和处理
4. 实现分支预测
5. 添加缓存模型 